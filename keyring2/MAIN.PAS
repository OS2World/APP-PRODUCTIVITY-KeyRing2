{$R-,S-,I-,V-,B-}

unit MAIN;

interface

{$I OPDEFINE.INC}

uses
  Dos,
  OpInline,
  OpString,
  OpRoot,
  OpCrt,
  OpColor,
  {$IFDEF UseMouse}
  OpMouse,
  {$ENDIF}
  OpDate,
  OpAbsFld,
  OpCmd,
  OpField,
  OpFrame,
  OpWindow,
  OpSelect,
  OpEntry;

{Entry field constants}
const
  idFirstName            = 0;
  idQty                  = idFirstName + 1;
  idLastName             = idQty + 1;
  idOrderNum             = idLastName + 1;
  idCompanyName          = idOrderNum + 1;
  idWPIName              = idCompanyName + 1;
  idAddr1                = idWPIName + 1;
  idAddr2                = idAddr1 + 1;
  idCity                 = idAddr2 + 1;
  idState                = idCity + 1;
  idZip                  = idState + 1;
  idCountry              = idZip + 1;
  idDomestic             = idCountry + 1;
  idCitizen              = idDomestic + 1;
  idAgree                = idCitizen + 1;
  idEmail                = idAgree + 1;
  idPhone                = idEmail + 1;
  idFeatureBits          = idPhone + 1;
  idDemoLifeDays         = idFeatureBits + 1;
  idIP                   = idDemoLifeDays + 1;
  idDropDead             = idIP + 1;
  idDomain               = idDropDead + 1;
  idLimits               = idDomain + 1;
  idRegCode              = idLimits + 1;
  idComment              = idRegCode + 1;

{Help index constants}
const
  hiFirstName            = 1;
  hiQty                  = hiFirstName + 1;
  hiLastName             = hiQty + 1;
  hiOrderNum             = hiLastName + 1;
  hiCompanyName          = hiOrderNum + 1;
  hiWPIName              = hiCompanyName + 1;
  hiAddr1                = hiWPIName + 1;
  hiAddr2                = hiAddr1 + 1;
  hiCity                 = hiAddr2 + 1;
  hiState                = hiCity + 1;
  hiZip                  = hiState + 1;
  hiCountry              = hiZip + 1;
  hiDomestic             = hiCountry + 1;
  hiCitizen              = hiDomestic + 1;
  hiAgree                = hiCitizen + 1;
  hiEmail                = hiAgree + 1;
  hiPhone                = hiEmail + 1;
  hiFeatureBits          = hiPhone + 1;
  hiDemoLifeDays         = hiFeatureBits + 1;
  hiIP                   = hiDemoLifeDays + 1;
  hiDropDead             = hiIP + 1;
  hiDomain               = hiDropDead + 1;
  hiLimits               = hiDomain + 1;
  hiRegCode              = hiLimits + 1;
  hiComment              = hiRegCode + 1;

type
  UserRecord =
    record
      FirstName            : string[30];
      Qty                  : LongInt;
      LastName             : string[30];
      OrderNum             : string[30];
      CompanyName          : string[30];
      WPIName              : string[12];
      Addr1                : string[30];
      Addr2                : string[30];
      City                 : string[30];
      State                : string[30];
      Zip                  : string[30];
      Country              : string[30];
      Domestic             : string[10];
      Citizen              : string[30];
      Agree                : Boolean;
      Email                : string[30];
      Phone                : string[18];
      FeatureBits          : LongInt;
      DemoLifeDays         : LongInt;
      IP                   : string[15];
      DropDead             : Date;
      Domain               : string[30];
      Limits               : string[61];
      RegCode              : string[16];
      Comment              : string[254];
    end;

function InitEntryScreen(var ES : ScrollingEntryScreen;
                         var UR : UserRecord;
                         var EsColors : ColorSet) : Word;
  {-Initialize entry screen generated by MAKESCRN}

procedure InitUserRecord(var UR : UserRecord);
  {-Initialize user record}

  {===========================================================}

implementation

procedure InitUserRecord(var UR : UserRecord);
begin
  FillChar(UR, SizeOf(UR), 0);
  UR.DemoLifeDays := 10;
  UR.DropDead := BadDate;
end;

function InitEntryScreen(var ES : ScrollingEntryScreen;
                         var UR : UserRecord;
                         var EsColors : ColorSet) : Word;
const
  Frame1 = 'ÉÈ»¼ÍÍºº';
  WinOptions = wBordered+wClear+wUserContents+wResizeable;
begin
  with ES do begin
    if not InitCustom(2, 2, 79, 20, EsColors, WinOptions) then begin
      InitEntryScreen := InitStatus;
      Exit;
    end;

    wFrame.SetFrameType(Frame1);
    EnableExplosions(20);
    wFrame.AddHeader(' KeyRing/2 Key DLL Generator ', heTC);
    esOptionsOff(esMousePage);
    SetWrapMode(WrapAtEdges);

    AddLineField('Ä', 'Ä', 'Ä', 12, 1, 78, False);
    AddLineField('Ä', 'Ä', 'Ä', 15, 1, 78, False);

  {idFirstName:}
    esFieldOptionsOn(efClearFirstChar+efRequired);
    AddStringField(
      'First Name:', 1, 2, 
      CharStr('X', 30), 1, 17, 30, 
      hiFirstName, UR.FirstName);
    esFieldOptionsOff(efClearFirstChar+efRequired);

  {idQty:}
    esFieldOptionsOn(efProtected+efClearFirstChar);
    AddLongField(
      'Qty :', 1, 48, 
      '9999', 1, 57, 
      hiQty, 0, $7FFFFFFF, UR.Qty);
    esFieldOptionsOff(efProtected+efClearFirstChar);

  {idLastName:}
    esFieldOptionsOn(efClearFirstChar+efRequired);
    AddStringField(
      'Last Name:', 2, 2, 
      CharStr('X', 30), 2, 17, 30, 
      hiLastName, UR.LastName);
    esFieldOptionsOff(efClearFirstChar+efRequired);

  {idOrderNum:}
    esFieldOptionsOn(efProtected);
    AddStringField(
      'OrdNum :', 2, 48, 
      CharStr('X', 30), 2, 57, 30, 
      hiOrderNum, UR.OrderNum);
    esFieldOptionsOff(efProtected);

  {idCompanyName:}
    esFieldOptionsOn(efClearFirstChar);
    AddStringField(
      'Company Name: ', 3, 2, 
      CharStr('X', 30), 3, 17, 30, 
      hiCompanyName, UR.CompanyName);
    esFieldOptionsOff(efClearFirstChar);

  {idWPIName:}
    esFieldOptionsOn(efProtected);
    AddStringField(
      'WPI :', 3, 48, 
      'XXXXXXXXXXXX', 3, 57, 12, 
      hiWPIName, UR.WPIName);
    esFieldOptionsOff(efProtected);

  {idAddr1:}
    AddStringField(
      'Addr1:', 4, 2, 
      CharStr('X', 30), 4, 17, 30, 
      hiAddr1, UR.Addr1);

  {idAddr2:}
    AddStringField(
      'Addr2:', 5, 2, 
      CharStr('X', 30), 5, 17, 30, 
      hiAddr2, UR.Addr2);

  {idCity:}
    AddStringField(
      'City:', 6, 2, 
      CharStr('X', 30), 6, 17, 30, 
      hiCity, UR.City);

  {idState:}
    AddStringField(
      'State:', 7, 2, 
      CharStr('X', 30), 7, 17, 30, 
      hiState, UR.State);

  {idZip:}
    AddStringField(
      'Zip:', 8, 2, 
      CharStr('X', 30), 8, 17, 30, 
      hiZip, UR.Zip);

  {idCountry:}
    AddStringField(
      'Country:', 9, 2, 
      CharStr('X', 30), 9, 17, 30, 
      hiCountry, UR.Country);

  {idDomestic:}
    AddStringField(
      'Crypter:', 9, 48, 
      'XXXXXXXXXX', 9, 57, 10, 
      hiDomestic, UR.Domestic);

  {idCitizen:}
    esFieldOptionsOn(efProtected);
    AddStringField(
      'Citizen:', 10, 2, 
      CharStr('X', 30), 10, 17, 30, 
      hiCitizen, UR.Citizen);
    esFieldOptionsOff(efProtected);

  {idAgree:}
    esFieldOptionsOn(efProtected+efClickExit);
    AddYesNoField(
      'Agreed:', 10, 48, 
      'Y', 10, 57, 
      hiAgree, UR.Agree);
    esFieldOptionsOff(efProtected+efClickExit);

  {idEmail:}
    esFieldOptionsOn(efClearFirstChar+efRequired);
    AddStringField(
      'Email:', 11, 2, 
      CharStr('X', 30), 11, 17, 30, 
      hiEmail, UR.Email);
    esFieldOptionsOff(efClearFirstChar+efRequired);

  {idPhone:}
    AddStringField(
      'Ph:', 11, 48, 
      'XXXXXXXXXXXXXXXXXX', 11, 57, 17, 
      hiPhone, UR.Phone);

  {idFeatureBits:}
    AddLongField(
      'Features:', 13, 2, 
      'KKKKKKKK', 13, 17, 
      hiFeatureBits, $80000000, $7FFFFFFF, UR.FeatureBits);

  {idDemoLifeDays:}
    esFieldOptionsOn(efClearFirstChar+efBeepOnError+efAutoNumLock);
    AddLongField(
      'Demo Life:', 13, 28, 
      '999999999', 13, 39, 
      hiDemoLifeDays, 10, 200000000, UR.DemoLifeDays);
    esFieldOptionsOff(efClearFirstChar+efBeepOnError+efAutoNumLock);

  {idIP:}
    esFieldOptionsOn(efProtected);
    AddStringField(
      'IP:', 13, 50, 
      'XXXXXXXXXXXXXXX', 13, 54, 15, 
      hiIP, UR.IP);
    esFieldOptionsOff(efProtected);

  {idDropDead:}
    esFieldOptionsOn(efBeepOnError+efAutoNumLock);
    esFieldOptionsOff(efTrimBlanks);
    AddDateField(
      'Drop Dead:', 14, 2, 
      'mm/dd/yyyy', 14, 17, 
      hiDropDead, MinDate, MinDate, UR.DropDead);
    esFieldOptionsOn(efTrimBlanks);
    esFieldOptionsOff(efBeepOnError+efAutoNumLock);

  {idDomain:}
    esFieldOptionsOn(efProtected);
    AddStringField(
      'Domain:', 14, 28, 
      CharStr('X', 30), 14, 39, 30, 
      hiDomain, UR.Domain);
    esFieldOptionsOff(efProtected);

  {idLimits:}
    AddStringField(
      'Limits:', 16, 2, 
      CharStr('X', 61), 16, 17, 61, 
      hiLimits, UR.Limits);

  {idRegCode:}
    AddStringField(
      'Reg Code :', 17, 2, 
      'XXXXXXXXXXXXXXXX', 17, 17, 16, 
      hiRegCode, UR.RegCode);

  {idComment:}
    AddStringField(
      'Comment :', 18, 2, 
      CharStr('X', 254), 18, 17, 61, 
      hiComment, UR.Comment);

    AllocateScreen;

    if RawError <> 0 then
      ES.Done;

    InitEntryScreen := RawError;
  end;
end;

end.
