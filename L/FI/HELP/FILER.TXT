;
;-------------------------------------------------------------------
!TOPIC 487 Filer
B-Tree Filer offers you a high-quality library to manage databases in an
efficient and easy-to-use manner. It includes many features that set it
apart from the competition:

!NOWRAP
  - integral support for multi-user, networked databases
  - strict error checking and safety modes to maximize data integrity
  - written in Turbo Pascal, with full source code provided
  - fixed and variable length record support
  - all indices stored in one file to minimize file handle usage
  - separate data and index files to maximize data integrity
  - support for EMS and normal heap memory for index page buffers
  - no TSR's required at runtime
  - powerful utility units for browsing, rebuilding and sorting data files
  - support for Novell, MS-NET, and all NetBIOS compatible networks
  - network utility units for NetWare, NetBIOS, and the MS-NET Redirector
  - POPHELP on-line help reference
!WRAP

B-Tree Filer is based on an improved version of the balanced B-Tree
algorithm, which has proven itself as one of the best methods to access
data in large databases.

The FILER unit implements the B-Tree manager. It includes a collection of
routines for managing data and index files.

  0488Fileblock operations         0491Fileblock information
  0489Data file operations         0490Index file operations
  0492Locking operations           0495Low level routines
  0493Declarations                 0494Error codes
;
;-------------------------------------------------------------------
!TOPIC 488 Fileblock operations
!NOINDEX
!NOSEARCH
The routines in this category are for overall initialization of the
Filer unit and for operations on fileblocks as a whole.

  0556BTCloseAllFileBlocks  0555BTCloseFileBlock
  0553BTCreateFileBlock     0557BTDeleteFileBlock
  0497BTExitIsam            0551BTFlushAllFileBlocks
  0552BTFlushFileBlock      0519BTForceNetBufferWriteThrough
  0514BTForceWritingMark    0628BTInformTTSAbortSuccessful
  0496BTInitIsam            0498BTIsamErrorClass
  0516BTNetSupported        0517BTNoNetCompiled
  0554BTOpenFileBlock       0618BTPeekNetSupported
  0619BTPeekNoNetCompiled   0644BTSetCharConvert
  0515BTSetDosRetry
;
;-------------------------------------------------------------------
!TOPIC 489 Data file operations
!NOINDEX
!NOSEARCH
The routines in this category are for reading and writing the data file of
a fileblock.

  0523BTAddRec                0524BTDeleteRec
  0636BTFindRecRef            0630BTGetAfterNextUsedAddRecRef
  0637BTGetApprRecPos         0638BTGetApprRecRef
  0629BTGetNextUsedAddRecRef  0521BTGetRec
  0522BTGetRecReadOnly        0627BTGetStartingLong
  0641BTNextRecRef            0643BTPrevRecRef
  0520BTPutRec
;
;-------------------------------------------------------------------
!TOPIC 490 Index file operations
!NOINDEX
!NOSEARCH
The routines in this category are for searching, scanning or modifying
the index file of a fileblock.

  0545BTAddKey                        0535BTClearKey
  0547BTDeleteAllKeys                 0546BTDeleteKey
  0538BTFindKey                       0540BTFindKeyAndRef
  0550BTGetApprKeyAndRef              0549BTGetApprRelPos
  0542BTKeyExists                     0543BTNextDiffKey
  0536BTNextKey                       0544BTPrevDiffKey
  0537BTPrevKey                       0539BTSearchKey
  0541BTSearchKeyAndRef               0533BTSetSearchForSequential
;
;-------------------------------------------------------------------
!TOPIC 491 Fileblock information
!NOINDEX
!NOSEARCH
The routines in this category are for returning information about a
fileblock.

  0558BTDataFileName               0530BTDatRecordSize
  0512BTFileBlockIsLocked          0511BTFileBlockIsOpen
  0513BTFileBlockIsReadLocked      0528BTFileLen
  0527BTFreeRecs                   0645BTGetAllowDupKeys
  0631BTGetInternalDialogID        0639BTGetKeyLen
  0534BTGetSearchForSequential     0559BTIndexFileName
  0640BTIsInitialized              0518BTIsNetFileBlock
  0531BTKeyRecordSize              0532BTMinimumDatKeys
  0529BTNrOfKeys                   0548BTOtherWSChangedKey
  0625BTPeekDataFileName           0622BTPeekDatRecordSize
  0616BTPeekFileBlockIsLocked      0615BTPeekFileBlockIsOpen
  0617BTPeekFileBlockIsReadLocked  0626BTPeekIndexFileName
  0620BTPeekIsNetFileBlock         0623BTPeekKeyRecordSize
  0624BTPeekMinimumDatKeys         0621BTPeekNrOfKeys
  0526BTUsedKeys                   0525BTUsedRecs
;
;-------------------------------------------------------------------
!TOPIC 492 Locking operations
!NOINDEX
!NOSEARCH
The routines in this category are for locking and unlocking fileblocks
and records, and for returning information about locks.

  0509BTaRecIsLocked                  0510BTGetRecordInfo
  0503BTLockAllOpenFileBlocks         0500BTLockFileBlock
  0505BTLockRec                       0613BTPeekaRecIsLocked
  0614BTPeekGetRecordInfo             0612BTPeekRecIsLocked
  0502BTReadLockAllOpenFileBlocks     0499BTReadLockFileBlock
  0508BTRecIsLocked                   0504BTUnLockAllOpenFileBlocks
  0501BTUnLockFileBlock               0507BTUnLockAllRecs
  0506BTUnLockRec
;
;-------------------------------------------------------------------
!TOPIC 493 Declarations,B-Tree Filer
!NOINDEX
!NOSEARCH
B-Tree Filer interfaces the following types, constants and variables:

  0582AddNullKeys                     0583DatExtension
  0584DiaExtension                    0634InheritFileHandles
  0585IsamCompiledNets                0586IsamDelayBetwLocks
  0587IsamDOSError                    0588IsamDOSFunc
  0589IsamError                       0632IsamFBLockTimeOutFactor
  0590IsamFile                        0591IsamFileBlockName
  0592IsamFileBlockPtr                0593IsamFileName
  0594IsamFileNameLen                 0595IsamFlushDOS33
  0596IsamIndDescr                    0597IsamKeyStr
  0633IsamLockTimeOut                 0598IsamOK
  0599IsamReXUserProcPtr              0600IxExtension
  0601MaxHeight                       0602MaxKeyLen
  0603MaxNrOfKeys                     0604MaxNrOfWorkStations
  0605MinimizeUseOfNormalHeap         0606MsgExtension
  0607NetSupportType                  0608PageSize
  0646ProcBTCharConvert               0609SavExtension
  0610SearchForSequentialDefault      0635TestNetExistance
  0611VersionStr
;
;-------------------------------------------------------------------
!TOPIC 494 Error codes
!NOINDEX
!NOSEARCH
The following table lists all of the error codes that can be returned
in the <IsamError> variable. The table is formatted as follows:

!NOWRAP
;!TABLE
ErrorNumber (ErrorClass) Routines that may generate the error
Brief description of the error

8000   (4)    user
The range 8000..8999 is reserved for user-defined codes, BONUS units,
etc.

9500   (4)    general
The range 9500..9899 is reserved for IOResult error codes. Subtract
9500 to get the true IOResult code, then refer to the Turbo Pascal
Programmer's Guide or a DOS reference manual.

9900   (2)    general
Invalid path name, or drive not ready under Windows and protected mode.

9901   (4)    general
Too many open files.

9902   (4)    general
Current directory is full.

9903   (1)    general
File not found.

9904   (4)    general
Invalid file descriptor (usually bad DOS file handle number).

9905   (4)    general
Read request exceeds 64K bytes.

9906   (4)    general
Write request exceeds 64K bytes.

9908   (4)    general
Invalid file access mode.

10000  (4)    0496BTInitIsam
Number of page buffers is less than 0601MaxHeight.

10001  (3)    0523BTAddRec
10002  (3)    0524BTDeleteRec
10003  (3)    0545BTAddKey
10004  (3)    0546BTDeleteKey
10005  (3)    0547BtDeleteAllKeys
Serious I/O error in save mode. The fileblock is still in usable state
but the last operation was not completed.

10010  (4)    0554BTOpenFileBlock
Index file probably corrupt (wasn't closed properly after last
modification).

10020  (4)    0553BTCreateFileBlock
Record length out of range (<21 bytes).

10030  (4)    0554BTOpenFileBlock, 0553BTCreateFileBlock
Insufficient memory for key descriptors.

10040  (4)    3683BTAddVariableRec, 3685BTPutVariableRec
Insufficient memory for variable record buffer expansion.

10050  (4)    0553BTCreateFileBlock
Invalid number of keys specified (<0 or >0603MaxNrOfKeys).

10055  (4)    0553BTCreateFileBlock
Key length out of range (<1 or >0602MaxKeyLen).

10060  (4)    0554BTOpenFileBlock
Too many keys, or file read error (>0603MaxNrOfKeys).

10065  (4)    general
An attempt has been made to write to a fileblock opened in read only
mode.

10070  (4)    general
File read error. Common reasons for this error include: Dialog file
left corrupted by a previous program run (delete the dialog file at
the DOS command line); 0521BTGetRec specified an invalid record number
(larger than 0528BTFileLen); two different programs compiled with
different 0604MaxNrOfWorkStations constants are trying to access the same
fileblock; a physical hard disk error.

10075  (4)    general
File write error.

10080  (4)    0555BTCloseFileBlock
Fileblock not open.

10090  (4)    0553BTCreateFileBlock
10100  (4)    0554BTOpenFileBlock
Insufficient memory for an IsamFileBlock variable.

10110  (2)    general
Drive not ready.

10120  (4)    0554BTOpenFileBlock
Index header corrupt; cannot calculate key length.

10121  (4)    0554BTOpenFileBlock
0602MaxKeyLen now incompatible with fileblock.

10122  (4)    0554BTOpenFileBlock
PageSize for fileblock is greater than 0608MaxPageSize

10125  (4)    0545BTAddKey
Key length too long (>max length for its index).

10130  (4)    0520BTPutRec
Attempt to write to record number 0.

10135  (4)    0524BTDeleteRec
Attempt to delete record number 0 or a number greater than
the total in the file.

10140  (4)    general
Unexpected DOS error (check 0587IsamDOSError and 0588IsamDOSFunc).

10150  (4)    general
Out of handles on flush of network fileblock.

10160  (4)    0555BTCloseFileBlock
Fileblock not correctly closed.

10164  (4)    general
Invalid key number (<1 or >max index for this fileblock).

10170  (4)    0523BTAddRec, 0524BTDeleteRec
Free record list corrupt (attempt to use record 0).

10180  (4)    general
Attempt to repair fileblock failed.

10190  (4)    0848ExtendHandles
Requires DOS 3.3 or later.

10191  (4)    0848ExtendHandles
Insufficient memory for new file handle table.

10192  (4)    0848ExtendHandles
Unable to obtain new file handle table from DOS.

10200  (1)    0538BTFindKey.
No matching key found

10205  (1)    0522BTGetRecReadOnly
Data record is locked.

10210  (1)    0539BTSearchKey
No key found and no larger keys available.

10215  (1)    3008ReIndexFileBlock
Data file is defective

10220  (1)    0546BTDeleteKey
Key to delete was not found.

10230  (1)    0545BTAddKey
Cannot add duplicate key.

10240  (1)    0543BTNextDiffKey
10250  (1)    0536BTNextKey
No larger key found.

10245  (1)    0544BTPrevDiffKey
10260  (1)    0537BTPrevKey
No smaller key found.

10255  (1)    0536BTNextKey
10265  (1)    0537BTPrevKey
Sequential access not allowed.

10270  (1)    0540BTFindKeyAndRef
No matching key and record number found.

10280  (1)    0550BTGetApprKeyAndRef
10285  (1)    0549BTGetApprRelPos
Index empty.

10306  (2)    0554BTOpenFileblock
Too many fileblock users

10310  (4)    0496BTInitIsam
Network initialization error.

10315  (4)    0497BTExitIsam
Network exit error.

10322  (4)    0555BTCloseFileBlock
Attempt to remove readlock failed.

10323  (4)    0555BTCloseFileBlock
Attempt to remove record lock failed.

10330  (2)    0500BTLockFileBlock, 0503BTLockAllOpenFileBlocks
Attempt to lock fileblock failed.

10332 (2)     0499BTReadLockFileBlock, 0502BTReadLockAllOpenFileBlocks
Attempt to readlock fileblock failed.

10335  (2)    0505BTLockRec
Attempt to lock record failed.

10337  (4)    0505BTLockRec
Insufficient memory for lock list expansion.

10340  (4)    0501BTUnlockFileBlock, 0504BTUnlockAllOpenFileBlocks
10342  (4)    0554BTOpenFileBlock
Attempt to unlock fileblock failed.

10341  (4)    general
Attempt to remove readlock failed.

10345  (4)    0506BTUnlockRec
Attempt to unlock record failed.

10355  (2)    0554BTOpenFileBlock
10399  (2)    general
A lock prevents the operation.

10356  (4)    0554BTOpenFileBlock
Insufficient memory for network support record.

10397  (2)    general
Fileblock is read-only or a lock prevents operation.

10398  (4)    general
Fileblock must be locked for this operation.

10410  (1)    3007RestructFileBlock
Data file not found.

10411  (4)    3007RestructFileBlock  3008ReIndexFileBlock
Insufficient memory for work buffers.

10412  (4)    3007RestructFileBlock  3008ReIndexFileBlock
Section length exceeds 64K.

10415  (4)    general (3678VRec unit)
Too many sections in a variable rec (total length exceeds $FFF0).

10420  (4)    0550BTGetApprKeyAndRef  0638BTGetApprRecRef
10425  (4)    0549BTGetApprRelPos  0637BTGetApprRecPos
Relative position or scale invalid.

10430  (4)    general
Fileblock repair not allowed in read-only mode.

10435  (4)    0496BTInitIsam
Index page larger than 16K bytes.

10440  (4)    0554BTOpenFileBlock
Cannot create dialog file in read-only mode.

10445  (4)    general
Fileblock pointer or descriptor corrupted (MEMORY OVERWRITE).

10446  (4)    general
Recursive call to B-Tree Filer when EMS in use.

10450  (4)    0496BTInitIsam
BTInitIsam called twice.

10455  (4)    general
BTInitIsam has not been called.

10460  (4)    3007RestructFileBlock  3008ReIndexFileBlock
Reorganization aborted.

10465  (4)    3007RestructFileBlock  3008ReIndexFileBlock
Both data (extension .DAT) and save (extension .SAV) files exist.
Indicates that a previous rebuild or reorganisation failed.

10470  (4)    3008ReIndexFileBlock
Reindexing aborted.

10475  (4)    3007RestructFileBlock
Restructing aborted.

10480  (4)    0554BTOpenFileBlock
Operating system's locking function not working.
!WRAP

See also:  0498BTIsamErrorClass  0849IsamErrorMessage
           0588IsamDOSFunc       0587IsamDOSError
;
;-------------------------------------------------------------------
!TOPIC 495 Low level routines
!NOINDEX
!NOSEARCH
The routines in this category are designed primarily for internal use by
B-Tree Filer:

  0580BTIsamLockRecord  0581BTIsamUnlockRecord
  0642BTNoCharConvert   0562IsamAssign
  0570IsamBlockRead     0571IsamBlockReadRetLen
  0572IsamBlockWrite    0560IsamClearOK
  0565IsamClose         0577IsamCopyFile
  0579IsamDelay         0566IsamDelete
  0561IsamExists        0576IsamExtractFileNames
  0575IsamFlush         0578IsamForceExtension
  0573IsamGetBlock      0568IsamLongSeek
  0569IsamLongSeekEOF   0574IsamPutBlock
  0567IsamRename        0564IsamReset
  0563IsamRewrite
;
;-------------------------------------------------------------------
!TOPIC 496 BTInitIsam
!NOINDEX
function 0487Filer.BTInitIsam(ExpectedNet : NetSupportType;
                          Free : LongInt;
                          NrOfEMSTreePages : Word) : LongInt;

Initializes B-Tree Filer and allocates memory from the normal
heap and/or the EMS heap. ExpectedNet is the network type or
NoNet. Free is the number of bytes of heap space to leave free.
NrOfEmsTreePages is the number of index page buffers to
allocate in expanded memory.

See also:  0497BTExitIsam  0368EmsHeap  0607NetSupportType
;
;-------------------------------------------------------------------
!TOPIC 497 BTExitIsam
!NOINDEX
procedure 0487Filer.BTExitIsam;

Deallocates page buffer space and shuts down the selected
network, if any.

See also:  0496BTInitIsam
;
;-------------------------------------------------------------------
!TOPIC 498 BTIsamErrorClass
!NOINDEX
function 0487Filer.BTIsamErrorClass : Integer;

Returns error class in the range 0..4 for current value of
IsamError. Error classes are as follows:

!NOWRAP
;!TABLE
  0  No error
  1  User error (key not found, etc.)
  2  Locking error (only on a network)
  3  Operation did not succeed, but fileblocks are ok (only in save mode)
  4  Hard error
!WRAP
;
;-------------------------------------------------------------------
!TOPIC 499 BTReadLockFileBlock
!NOINDEX
procedure 0487Filer.BTReadLockFileBlock(IFBPtr : IsamFileBlockPtr);

Readlocks a fileblock (prevents writing to it from any other
workstation).

See also:  0500BTLockFileBlock  0502BTReadLockAllOpenFileBlocks  0501BTUnlockFileBlock
;
;-------------------------------------------------------------------
!TOPIC 500 BTLockFileBlock
!NOINDEX
procedure 0487Filer.BTLockFileBlock(IFBPtr : IsamFileBlockPtr);

Locks a fileblock for exclusive access (current station may
modify data and index files, no other station may read or
write).

See also:  0503BTLockAllOpenFileBlocks  0499BTReadLockFileBlock  0501BTUnlockFileBlock
;
;-------------------------------------------------------------------
!TOPIC 501 BTUnLockFileBlock
!NOINDEX
procedure 0487Filer.BTUnLockFileBlock(IFBPtr : IsamFileBlockPtr);

Removes read or write locks from a fileblock.

See also:  0500BTLockFileBlock  0499BTReadLockFileBlock
;
;-------------------------------------------------------------------
!TOPIC 502 BTReadLockAllOpenFileBlocks
!NOINDEX
procedure 0487Filer.BTReadLockAllOpenFileBlocks;

Readlocks all open network fileblocks.

See also:
    0503BTLockAllOpenFileBlocks           0499BTReadLockFileBlock
    0504BTUnlockAllOpenFileBlocks
;
;-------------------------------------------------------------------
!TOPIC 503 BTLockAllOpenFileBlocks
!NOINDEX
procedure 0487Filer.BTLockAllOpenFileBlocks;

Locks all open fileblocks for exclusive access.

See also:
    0500BTLockFileBlock                   0502BTReadLockAllOpenFileBlocks
    0504BTUnlockAllOpenFileBlocks
;
;-------------------------------------------------------------------
!TOPIC 504 BTUnLockAllOpenFileBlocks
!NOINDEX
procedure 0487Filer.BTUnLockAllOpenFileBlocks;

Unlocks all open fileblocks (removes both readlocks and
exclusive access locks).

See also:
    0503BTLockAllOpenFileBlocks           0502BTReadLockAllOpenFileBlocks
    0501BTUnlockFileBlock
;
;-------------------------------------------------------------------
!TOPIC 505 BTLockRec
!NOINDEX
procedure 0487Filer.BTLockRec(IFBPtr : IsamFileBlockPtr; Ref : LongInt);

Locks specified record.

See also:  0500BTLockFileBlock  0499BTReadLockFileBlock  0506BTUnlockRec
;
;-------------------------------------------------------------------
!TOPIC 506 BTUnLockRec
!NOINDEX
procedure 0487Filer.BTUnLockRec(IFBPtr : IsamFileBlockPtr; Ref : LongInt);

Unlocks specified record.

See also:  0505BTLockRec  0507BTUnlockAllRecs  0501BTUnlockFileBlock
;
;-------------------------------------------------------------------
!TOPIC 507 BTUnLockAllRecs
!NOINDEX
procedure 0487Filer.BTUnLockAllRecs(IFBPtr : IsamFileBlockPtr);

Unlocks all locked records of a fileblock.

See also:  0509BTaRecIsLocked  0506BTUnlockRec
;
;-------------------------------------------------------------------
!TOPIC 508 BTRecIsLocked
!NOINDEX
function 0487Filer.BTRecIsLocked(IFBPtr : IsamFileBlockPtr;
                             Ref : LongInt) : Boolean;

Returns True if specified record is locked.

See also:  0509BTaRecIsLocked  0506BTUnlockRec
;
;-------------------------------------------------------------------
!TOPIC 509 BTaRecIsLocked
!NOINDEX
function 0487Filer.BTaRecIsLocked(IFBPtr : IsamFileBlockPtr) : Boolean;

Returns True if any record in specified fileblock is locked.

See also:  0505BTLockRec  0508BTRecIsLocked
;
;-------------------------------------------------------------------
!TOPIC 510 BTGetRecordInfo
!NOINDEX
procedure 0487Filer.BTGetRecordInfo(IFBPtr : IsamFileBlockPtr;
                                Ref : LongInt;
                                var Start, Len : LongInt;
                                var Handle : Word);

Returns information about the specified record, useful for
implementing alternate locking schemes.
;
;-------------------------------------------------------------------
!TOPIC 511 BTFileBlockIsOpen
!NOINDEX
function 0487Filer.BTFileBlockIsOpen(IFBPtr : IsamFileBlockPtr) : Boolean;

Returns True if the specified fileblock is currently open.

See also:  0555BTCloseFileBlock  0554BTOpenFileBlock
;
;-------------------------------------------------------------------
!TOPIC 512 BTFileBlockIsLocked
!NOINDEX
function 0487Filer.BTFileBlockIsLocked(IFBPtr : IsamFileBlockPtr) : Boolean;

Returns True if the specified fileblock is currently locked.

See also:  0513BTFileBlockIsReadLocked
;
;-------------------------------------------------------------------
!TOPIC 513 BTFileBlockIsReadLocked
!NOINDEX
function 0487Filer.BTFileBlockIsReadLocked(IFBPtr : IsamFileBlockPtr)
  : Boolean;

Returns True, if the fileblock is currently readlocked.

See also:  0512BTFileBlockIsLocked
;
;-------------------------------------------------------------------
!TOPIC 514 BTForceWritingMark
!NOINDEX
procedure 0487Filer.BTForceWritingMark(FFM : Boolean);

Enable or disable write-through (flushing) of the
fileblock-modified marker.

See also:  0552BTFlushFileBlock  0519BTForceNetBufferWriteThrough
;
;-------------------------------------------------------------------
!TOPIC 515 BTSetDosRetry
!NOINDEX
function 0487Filer.BTSetDosRetry(NrOfRetries, WaitTime : Integer) : Boolean;

Set the number of automatic retry attempts and timeout time
for a read attempt aborted by a lock on a MS-NET compatible
network.
;
;-------------------------------------------------------------------
!TOPIC 516 BTNetSupported
!NOINDEX
function 0487Filer.BTNetSupported : NetSupportType;

Returns the currently initialized network.

See also:  0496BTInitIsam  0518BTIsNetFileBlock  0517BTNoNetCompiled
;
;-------------------------------------------------------------------
!TOPIC 517 BTNoNetCompiled
!NOINDEX
function 0487Filer.BTNoNetCompiled : Boolean;

Returns True if B-Tree Filer was compiled without network
support.

See also:  0496BTInitIsam  0518BTIsNetFileBlock  0516BTNetSupported
;
;-------------------------------------------------------------------
!TOPIC 518 BTIsNetFileBlock
!NOINDEX
function 0487Filer.BTIsNetFileBlock(IFBPtr : IsamFileBlockPtr) : Boolean;

Returns True if the fileblock is a net fileblock (B-Tree Filer
wasn't compiled in NoNet mode, and 0554BTOpenFileBlock was called
with the Net parameter set to True).

See also:  0516BTNetSupported  0517BTNoNetCompiled
;
;-------------------------------------------------------------------
!TOPIC 519 BTForceNetBufferWriteThrough
!NOINDEX
procedure 0487Filer.BTForceNetBufferWriteThrough(DoIt : Boolean);

Activate or deactivate automatic flushing for network
fileblocks opened in save mode. Default is Off.

See also:  0552BTFlushFileBlock  0514BTForceWritingMark
;
;-------------------------------------------------------------------
!TOPIC 520 BTPutRec
!NOINDEX
procedure 0487Filer.BTPutRec(IFBPtr : IsamFileBlockPtr; RefNr : LongInt;
                         var Source; ISOLock : Boolean);

Modifies an existing record that has specified reference number.
If ISOLock is True, the write will occur even if another
workstation has the fileblock locked. Otherwise the current
workstation must have a network fileblock locked.

See also:  0523BTAddRec  0521BTGetRec
;
;-------------------------------------------------------------------
!TOPIC 521 BTGetRec
!NOINDEX
procedure 0487Filer.BTGetRec(IFBPtr : IsamFileBlockPtr; RefNr : LongInt;
                         var Dest; ISOLock : Boolean);

Reads an existing record that has the specified reference
number. If ISOLock is True, the read will occur even if another
workstation has the fileblock locked. The read will fail if the
record is locked by another workstation.

See also:  0522BTGetRecReadOnly
;
;-------------------------------------------------------------------
!TOPIC 522 BTGetRecReadOnly
!NOINDEX
procedure 0487Filer.BTGetRecReadOnly(IFBPtr : IsamFileBlockPtr;
                                 RefNr : LongInt;
                                 var Dest);

Reads an existing record that has the specified reference
number, even if the fileblock or record is locked by another
workstation. If the record is locked, the first four bytes of
Dest will remain uninitialized.

See also:  0521BTGetRec
;
;-------------------------------------------------------------------
!TOPIC 523 BTAddRec
!NOINDEX
procedure 0487Filer.BTAddRec(IFBPtr : IsamFileBlockPtr;
                         var RefNr : LongInt;
                         var Source);

Adds a record to a fileblock and returns its reference number.
A network fileblock must be locked for this call to succeed.

See also:  0545BTAddKey  0524BTDeleteRec  0521BTGetRec
;
;-------------------------------------------------------------------
!TOPIC 524 BTDeleteRec
!NOINDEX
procedure 0487Filer.BTDeleteRec(IFBPtr : IsamFileBlockPtr; RefNr : LongInt);

Deletes an existing record with the specified reference number.
A network fileblock must be locked for this call to succeed.

See also:  0523BTAddRec  0546BTDeleteKey
;
;-------------------------------------------------------------------
!TOPIC 525 BTUsedRecs
!NOINDEX
function 0487Filer.BTUsedRecs(IFBPtr : IsamFileBlockPtr) : LongInt;

Returns the number of currently used (non-deleted) records in
a fileblock.

See also:  0528BTFileLen  0527BTFreeRecs  0526BTUsedKeys
;
;-------------------------------------------------------------------
!TOPIC 526 BTUsedKeys
!NOINDEX
function 0487Filer.BTUsedKeys(IFBPtr : IsamFileBlockPtr;
                          Key : Word) : LongInt;

Returns the number of keys currently in a specified index.

See also:  0525BTUsedRecs
;
;-------------------------------------------------------------------
!TOPIC 527 BTFreeRecs
!NOINDEX
function 0487Filer.BTFreeRecs(IFBPtr : IsamFileBlockPtr) : LongInt;

Returns the number of records that have been deleted but not
reused in a fileblock.

See also:  0528BTFileLen  0525BTUsedRecs
;
;-------------------------------------------------------------------
!TOPIC 528 BTFileLen
!NOINDEX
function 0487Filer.BTFileLen(IFBPtr : IsamFileBlockPtr) : LongInt;

Returns the total number of records in a fileblock, including
those that are in use, those that have been deleted, and the
system record.

See also:  0527BTFreeRecs  0525BTUsedRecs
;
;-------------------------------------------------------------------
!TOPIC 529 BTNrOfKeys
!NOINDEX
function 0487Filer.BTNrOfKeys(IFBPtr : IsamFileBlockPtr) : Word;

Returns the number of indexes defined for the fileblock.

See also:  0553BTCreateFileBlock
;
;-------------------------------------------------------------------
!TOPIC 530 BTDatRecordSize
!NOINDEX
function 0487Filer.BTDatRecordSize(IFBPtr : IsamFileBlockPtr) : LongInt;

Returns the number of bytes in each data record for the
specified fileblock.

See also:  0531BTKeyRecordSize  0532BTMinimumDatKeys
;
;-------------------------------------------------------------------
!TOPIC 531 BTKeyRecordSize
!NOINDEX
function 0487Filer.BTKeyRecordSize(IFBPtr : IsamFileBlockPtr) : LongInt;

Returns the number of bytes in a page of the index file. This
is the maximum number of bytes of additional disk space that
might be required when a key is added.

See also:  0530BTDatRecordSize  0532BTMinimumDatKeys
;
;-------------------------------------------------------------------
!TOPIC 532 BTMinimumDatKeys
!NOINDEX
function 0487Filer.BTMinimumDatKeys(IFBPtr : IsamFileBlockPtr;
                                Space : LongInt) : LongInt;

Returns the minimum number of records and keys that can still
be added on a disk with Space bytes free.

See also:  0530BTDatRecordSize  0531BTKeyRecordSize
;
;-------------------------------------------------------------------
!TOPIC 533 BTSetSearchForSequential
!NOINDEX
procedure 0487Filer.BTSetSearchForSequential(IFBPtr : IsamFileBlockPtr;
                                         Key : Word; On : Boolean);

Enables or disables automatic search mode for sequential key
operations.

See also:
    0545BTAddKey                          0546BTDeleteKey
    0534BTGetSearchForSequential          0536BTNextKey
    0610SearchForSequentialDefault
;
;-------------------------------------------------------------------
!TOPIC 534 BTGetSearchForSequential
!NOINDEX
procedure 0487Filer.BTGetSearchForSequential(IFBPtr : IsamFileBlockPtr;
                                         Key : Word; var SFS : Boolean);

Returns whether automatic search mode is enabled for specified
fileblock and index.

See also:
    0545BTAddKey                          0546BTDeleteKey
    0536BTNextKey                         0533BTSetSearchForSequential
    0610SearchForSequentialDefault
;
;-------------------------------------------------------------------
!TOPIC 535 BTClearKey
!NOINDEX
procedure 0487Filer.BTClearKey(IFBPtr : IsamFileBlockPtr; Key : Word);

Resets the internal sequential pointer, so that BTNextKey will
return the first key and BTPrevKey will return the last key.

See also:  0536BTNextKey  0537BTPrevKey
;
;-------------------------------------------------------------------
!TOPIC 536 BTNextKey
!NOINDEX
procedure 0487Filer.BTNextKey(IFBPtr : IsamFileBlockPtr; Key : Word;
                          var UserDatRef : LongInt;
                          var UserKey : IsamKeyStr);

Returns in UserKey and UserDatRef the key string and data
reference number of the next key.

See also:  0537BTPrevKey  0610SearchForSequentialDefault
;
;-------------------------------------------------------------------
!TOPIC 537 BTPrevKey
!NOINDEX
procedure 0487Filer.BTPrevKey(IFBPtr : IsamFileBlockPtr; Key : Word;
                          var UserDatRef : LongInt;
                          var UserKey : IsamKeyStr);

Returns in UserKey and UserDatRef the key string and data
reference number of the previous key.

See also:  0536BTNextKey  0610SearchForSequentialDefault
;
;-------------------------------------------------------------------
!TOPIC 538 BTFindKey
!NOINDEX
procedure 0487Filer.BTFindKey(IFBPtr : IsamFileBlockPtr; Key : Word;
                          var UserDatRef : LongInt;
                          UserKey : IsamKeyStr);

Returns in UserDatRef the data reference number of the
specified key string. The match must be exact. If the index
allows duplicate keys, the smallest reference number for a
given key match is returned.

See also:  0540BTFindKeyAndRef  0542BTKeyExists  0539BTSearchKey  0541BTSearchKeyAndRef
;
;-------------------------------------------------------------------
!TOPIC 539 BTSearchKey
!NOINDEX
procedure 0487Filer.BTSearchKey(IFBPtr : IsamFileBlockPtr; Key : Word;
                            var UserDatRef : LongInt;
                            var UserKey : IsamKeyStr);

Returns in UserDatRef the data reference number of the
specified key string. If no exact match is found the key string
and reference number of the next larger key is returned.

See also:  0538BTFindKey  0536BTNextKey  0541BTSearchKeyAndRef
;
;-------------------------------------------------------------------
!TOPIC 540 BTFindKeyAndRef
!NOINDEX
procedure 0487Filer.BTFindKeyAndRef(IFBPtr : IsamFileBlockPtr; Key : Word;
                                var UserDatRef : LongInt;
                                var UserKey : IsamKeyStr;
                                NotFoundSearchDirection : Integer);

Returns in UserDatRef the data reference number of the
specified key string. If no exact match is found,
NotFoundSearchDirection determines what happens next. 0 means
to end the search; a positive value means to return the next
larger key and reference; a negative value means to return the
next smaller one.

See also:  0538BTFindKey  0542BTKeyExists  0539BTSearchKey  0541BTSearchKeyAndRef
;
;-------------------------------------------------------------------
!TOPIC 541 BTSearchKeyAndRef
!NOINDEX
procedure 0487Filer.BTSearchKeyAndRef(IFBPtr : IsamFileBlockPtr; Key : Word;
                                  var UserDatRef : LongInt;
                                  var UserKey : IsamKeyStr);

Returns in UserDatRef the data reference number of the
specified key string. If no exact match is found the key string
and reference number of the next larger key is returned. If
there is no larger key, the next smaller one is returned.

See also:  0538BTFindKey  0539BTSearchKey
;
;-------------------------------------------------------------------
!TOPIC 542 BTKeyExists
!NOINDEX
function 0487Filer.BTKeyExists(IFBPtr : IsamFileBlockPtr; Key : Word;
                           UserDatRef : LongInt;
                           UserKey : IsamKeyStr) : Boolean;

Returns True if the specified key and data reference number
exists in the index. UserDatRef is ignored for a primary index.

See also:  0538BTFindKey  0540BTFindKeyAndRef  0539BTSearchKey  0541BTSearchKeyAndRef
;
;-------------------------------------------------------------------
!TOPIC 543 BTNextDiffKey
!NOINDEX
procedure 0487Filer.BTNextDiffKey(IFBPtr : IsamFileBlockPtr; Key : Word;
                              var UserDatRef : LongInt;
                              var UserKey : IsamKeyStr);

Returns the key and reference number of the next index file
entry different than the specified one.

See also:  0536BTNextKey  0544BTPrevDiffKey
;
;-------------------------------------------------------------------
!TOPIC 544 BTPrevDiffKey
!NOINDEX
procedure 0487Filer.BTPrevDiffKey(IFBPtr : IsamFileBlockPtr;
                              Key : Word;
                              var UserDatRef : LongInt;
                              var UserKey : IsamKeyStr);

Returns the key and reference number of the next index file
entry smaller than the specified one. For duplicate keys, the
largest reference number is returned.

See also:  0543BTNextDiffKey  0537BTPrevKey
;
;-------------------------------------------------------------------
!TOPIC 545 BTAddKey
!NOINDEX
procedure 0487Filer.BTAddKey(IFBPtr : IsamFileBlockPtr; Key : Word;
                         UserDatRef : LongInt; UserKey : IsamKeyStr);

Adds a new key and data reference number to the specified index
of the index file. Network fileblocks must be locked.

See also:  0523BTAddRec  0546BTDeleteKey  0533BTSetSearchForSequential
;
;-------------------------------------------------------------------
!TOPIC 546 BTDeleteKey
!NOINDEX
procedure 0487Filer.BTDeleteKey(IFBPtr : IsamFileBlockPtr; Key : Word;
                            UserDatRef : LongInt; UserKey : IsamKeyStr);

Deletes the specified combination of UserKey and UserDatRef
from the index file. UserDatRef is ignored for primary indexes.
Network fileblocks must be locked.

See also:  0545BTAddKey
;
;-------------------------------------------------------------------
!TOPIC 547 BTDeleteAllKeys
!NOINDEX
procedure 0487Filer.BTDeleteAllKeys(IFBPtr : IsamFileBlockPtr; Key : Word);

Deletes all keys from the specified index. Network fileblocks
must be locked.

See also:  0546BTDeleteKey
;
;-------------------------------------------------------------------
!TOPIC 548 BTOtherWSChangedKey
!NOINDEX
function 0487Filer.BTOtherWSChangedKey(IFBPtr : IsamFileBlockPtr;
                                   Key : Word) : Boolean;

Returns True if another workstation has modified the specified
index since the current workstation's page buffers were
loaded.
;
;-------------------------------------------------------------------
!TOPIC 549 BTGetApprRelPos
!NOINDEX
procedure 0487Filer.BTGetApprRelPos(IFBPtr : IsamFileBlockPtr; Key : Word;
                                var RelPos : Word; Scale : Word;
                                UserKey : IsamKeyStr;
                                UserDatRef : LongInt);

Compute the relative position of UserKey and UserDatRef in the
B-tree, and return RelPos in the range 0..Scale.

See also:  0550BTGetApprKeyAndRef
;
;-------------------------------------------------------------------
!TOPIC 550 BTGetApprKeyAndRef
!NOINDEX
procedure 0487Filer.BTGetApprKeyAndRef(IFBPtr : IsamFileBlockPtr; Key : Word;
                                   RelPos : Word; Scale : Word;
                                   var UserKey : IsamKeyStr;
                                   var UserDatRef : LongInt);

Return approximate UserKey and UserDatRef corresponding to
relative position RelPos in the range 0..Scale.

See also:  0549BTGetApprRelPos
;
;-------------------------------------------------------------------
!TOPIC 551 BTFlushAllFileBlocks
!NOINDEX
procedure 0487Filer.BTFlushAllFileBlocks;

Flushes all buffered, new data of all fileblocks to disk.

See also:  0552BTFlushFileBlock
;
;-------------------------------------------------------------------
!TOPIC 552 BTFlushFileBlock
!NOINDEX
procedure 0487Filer.BTFlushFileBlock(IFBPtr : IsamFileBlockPtr);

Flushes all new data of a fileblock to disk.

See also:
    0551BTFlushAllFileBlocks              0519BTForceNetBufferWriteThrough
    0514BTForceWritingMark
;
;-------------------------------------------------------------------
!TOPIC 553 BTCreateFileBlock
!NOINDEX
procedure 0487Filer.BTCreateFileBlock(FName : IsamFileBlockName;
                                  DatSLen : LongInt;
                                  NumberOfKeys : Word;
                                  IID : IsamIndDescr);

Creates the disk files for a new fileblock. FName specifies
the name for the fileblock, DatSLen is the record length,
NumberOfKeys is the number of indexes, and IID describes the
maximum length of each key and whether it allows duplicates.

See also:  0557BTDeleteFileBlock  0554BTOpenFileBlock
;
;-------------------------------------------------------------------
!TOPIC 554 BTOpenFileBlock
!NOINDEX
procedure 0487Filer.BTOpenFileBlock(var IFBPtr : IsamFileBlockPtr;
                                FName : IsamFileBlockName;
                                ReadOnly, AllReadOnly,
                                Save, Net : Boolean);

Open an existing fileblock and allocate workspace for it.
FName is the name of the fileblock. ReadOnly is True if the
current workstation cannot write to the fileblock. AllReadOnly
is True if no workstation may write to it. Save is True to
activate save mode. Net is True if the fileblock is on a
shareable drive and more than one workstation may be accessing
it simultaneously.

See also:  0555BTCloseFileBlock  0553BTCreateFileBlock
;
;-------------------------------------------------------------------
!TOPIC 555 BTCloseFileBlock
!NOINDEX
procedure 0487Filer.BTCloseFileBlock(var IFBPtr : IsamFileBlockPtr);

Closes a fileblock and deallocates its workspace. All locks
are removed. IFBPtr is set to nil.

See also:  0556BTCloseAllFileBlocks  0553BTCreateFileBlock  0554BTOpenFileBlock
;
;-------------------------------------------------------------------
!TOPIC 556 BTCloseAllFileBlocks
!NOINDEX
procedure 0487Filer.BTCloseAllFileBlocks;

Closes all open fileblocks. Continues closing additional
fileblocks even if an error occurs.

See also:  0555BTCloseFileBlock
;
;-------------------------------------------------------------------
!TOPIC 557 BTDeleteFileBlock
!NOINDEX
procedure 0487Filer.BTDeleteFileBlock(FName : IsamFileBlockName);

Deletes a closed fileblock.

See also:  0553BTCreateFileBlock
;
;-------------------------------------------------------------------
!TOPIC 558 BTDataFileName
!NOINDEX
function 0487Filer.BTDataFileName(IFBPtr : IsamFileBlockPtr) : IsamFileName;

Returns the name of the data file for a fileblock.

See also:  0559BTIndexFileName
;
;-------------------------------------------------------------------
!TOPIC 559 BTIndexFileName
!NOINDEX
function 0487Filer.BTIndexFileName(IFBPtr : IsamFileBlockPtr) : IsamFileName;

Returns the name of the index file for a fileblock.

See also:  0558BTDataFileName
;
;-------------------------------------------------------------------
!TOPIC 560 IsamClearOK
!NOINDEX
procedure 0487Filer.IsamClearOK;

Resets all status variables, even internal ones. IsamOK is
True and IsamError is zero after this call.
;
;-------------------------------------------------------------------
!TOPIC 561 IsamExists
!NOINDEX
function 0487Filer.IsamExists(Name : IsamFileName) : Boolean;

Returns True if the specified file exists.
;
;-------------------------------------------------------------------
!TOPIC 562 IsamAssign
!NOINDEX
procedure 0487Filer.IsamAssign(var F : IsamFile; FName : IsamFileName);

Assigns a filename to a low level file variable.

See also:  0566IsamDelete  0567IsamRename  0564IsamReset  0563IsamRewrite
;
;-------------------------------------------------------------------
!TOPIC 563 IsamRewrite
!NOINDEX
procedure 0487Filer.IsamRewrite(var F : IsamFile);

Creates a new file. The file is left open, but it is not
shareable.

See also:  0562IsamAssign
;
;-------------------------------------------------------------------
!TOPIC 564 IsamReset
!NOINDEX
procedure 0487Filer.IsamReset(var F : IsamFile; NetUsed, ReadOnly : Boolean);

Opens a file in the specified mode. If NetUsed is True, the
file is opened in mode $42 (read/write deny none), unless
ReadOnly is also True in which case the file is opened in mode
$40 (read only deny none).

See also:  0562IsamAssign
;
;-------------------------------------------------------------------
!TOPIC 565 IsamClose
!NOINDEX
procedure 0487Filer.IsamClose(var F : IsamFile);

Closes a file.

See also:  0562IsamAssign  0564IsamReset  0563IsamRewrite
;
;-------------------------------------------------------------------
!TOPIC 566 IsamDelete
!NOINDEX
procedure 0487Filer.IsamDelete(var F : IsamFile);

Deletes a closed file.

See also:  0562IsamAssign
;
;-------------------------------------------------------------------
!TOPIC 567 IsamRename
!NOINDEX
procedure 0487Filer.IsamRename(var F : IsamFile; FName : IsamFileName);

Renames a closed but already assigned file.

See also:  0566IsamDelete
;
;-------------------------------------------------------------------
!TOPIC 568 IsamLongSeek
!NOINDEX
procedure 0487Filer.IsamLongSeek(var F : IsamFile; Ref : LongInt);

Seeks to the specified position in an open file.

See also:  0569IsamLongSeekEOF
;
;-------------------------------------------------------------------
!TOPIC 569 IsamLongSeekEOF
!NOINDEX
procedure 0487Filer.IsamLongSeekEOF(var F : IsamFile; var Len : LongInt);

Seeks to the end of an open file and returns its length.

See also:  0568IsamLongSeek
;
;-------------------------------------------------------------------
!TOPIC 570 IsamBlockRead
!NOINDEX
procedure 0487Filer.IsamBlockRead(var F : IsamFile; var Dest; Len : Word);

Reads a block of length Len from the current position in a
file to the variable Dest.

See also:  0572IsamBlockWrite  0573IsamGetBlock  0571IsamBlockReadRetLen
;
;-------------------------------------------------------------------
!TOPIC 571 IsamBlockReadRetLen
!NOINDEX
procedure 0487Filer.IsamBlockReadRetLen(var F : IsamFile; var Dest;
                                    Len : Word; var BytesRead : Word);

Reads a block of length Len from the current position in a
file to the variable Dest. Returns the number of bytes it could read.

See also:  0570IsamBlockRead
;
;-------------------------------------------------------------------
!TOPIC 572 IsamBlockWrite
!NOINDEX
procedure 0487Filer.IsamBlockWrite(var F : IsamFile; var Source; Len : Word);

Writes a block of length Len to the current position in a file
from the variable Source.

See also:  0570IsamBlockRead  0574IsamPutBlock
;
;-------------------------------------------------------------------
!TOPIC 573 IsamGetBlock
!NOINDEX
procedure 0487Filer.IsamGetBlock(var F : IsamFile;
                             Ref, Len : LongInt; var Dest);

Reads a block of length Len from position Ref of a file to the
variable Ref.

See also:  0570IsamBlockRead  0574IsamPutBlock
;
;-------------------------------------------------------------------
!TOPIC 574 IsamPutBlock
!NOINDEX
procedure 0487Filer.IsamPutBlock(var F : IsamFile;
                             Ref, Len : LongInt; var Source);

Writes a block of length Len to the position Ref of a file
from the variable Source.

See also:  0572IsamBlockWrite  0573IsamGetBlock
;
;-------------------------------------------------------------------
!TOPIC 575 IsamFlush
!NOINDEX
procedure 0487Filer.IsamFlush(var F : IsamFile; var WithDup : Boolean;
                          NetUsed : Boolean);

Flushes the DOS file buffers for a file to disk. Behavior is
affected by the parameter NetUsed and by the global typed
constant IsamFlushDOS33. If a duplicate handle was used to
perform the flush, WithDup is set to True.
;
;-------------------------------------------------------------------
!TOPIC 576 IsamExtractFileNames
!NOINDEX
procedure 0487Filer.IsamExtractFileNames(FNameComp : IsamFileBlockName;
                                     var FNameD,
                                         FNameI : IsamFileBlockName);

Splits two file names separated by a semicolon.
;
;-------------------------------------------------------------------
!TOPIC 577 IsamCopyFile
!NOINDEX
procedure 0487Filer.IsamCopyFile(Source, Dest : IsamFileBlockName;
                             DeleteSourceAfterCopy : Boolean);

Copies the file specified by Source to Dest, deleting the
original file if DeleteSourceAfterCopy is True.
;
;-------------------------------------------------------------------
!TOPIC 578 IsamForceExtension
!NOINDEX
function 0487Filer.IsamForceExtension(Name, Ext : IsamFileName)
  : IsamFileName;

Forces the extension Ext onto the filename Name.
;
;-------------------------------------------------------------------
!TOPIC 579 IsamDelay
!NOINDEX
procedure 0487Filer.IsamDelay(MilliSecs : LongInt);

Delays for the specified number of milliseconds. The routine
gives true millisecond resolution in a manner similar to the
CRT unit.
;
;-------------------------------------------------------------------
!TOPIC 580 BTIsamLockRecord
!NOINDEX
function 0487Filer.BTIsamLockRecord(Start, Len : LongInt;
                                Handle : Word;
                                TimeOut, DelayTime : Word) : Boolean;

Locks the bytes Start to Start+Len-1 of the file with handle
Handle using the network initialized by BTInitIsam. TimeOut
is the total time spent retrying the lock, in milliseconds.
DelayTime is the time to delay after a failed attempt to
lock.

See also:  0581BTIsamUnlockRecord
;
;-------------------------------------------------------------------
!TOPIC 581 BTIsamUnlockRecord
!NOINDEX
function 0487Filer.BTIsamUnlockRecord(Start, Len : LongInt;
                                Handle : Word) : Boolean;

Unlocks the bytes Start to Start+Len-1 of the file with handle
Handle using the network initialized by BTInitIsam.

See also:  0580BTIsamLockRecord
;
;-------------------------------------------------------------------
!TOPIC 582 AddNullKeys
!NOINDEX
const
  AddNullKeys : Boolean = True;

Setting to False suppresses the addition of empty key strings to
indexes generated by 2901ReorgFileBlock, 3794ReorgVFileBlock,
2800RebuildFileBlock, 3578RebuildVFileBlock, and
0747FixToVarFileBlock.
;
;-------------------------------------------------------------------
!TOPIC 583 DatExtension
!NOINDEX
const
  DatExtension : String[3] = 'DAT';

Extension applied to the data file of a fileblock.
;
;-------------------------------------------------------------------
!TOPIC 584 DiaExtension
!NOINDEX
const
  DiaExtension : String[3] = 'DIA';

Extension applied to the dialog file of a fileblock.
;
;-------------------------------------------------------------------
!TOPIC 585 IsamCompiledNets
!NOINDEX
var
  IsamCompiledNets : set of 0607NetSupportType;

Set containing all the network interfaces compiled into the Filer
unit (by enabling them in BTDEFINE.INC).
;
;-------------------------------------------------------------------
!TOPIC 586 IsamDelayBetwLocks
!NOINDEX
const
  IsamDelayBetwLocks : Word = 64;

Number of milliseconds to delay between retries while locking in
an MsNet environment.
;
;-------------------------------------------------------------------
!TOPIC 587 IsamDOSError
!NOINDEX
var
  IsamDOSError : Word;

DOS error code of the last DOS call made by a Filer routine.
;
;-------------------------------------------------------------------
!TOPIC 588 IsamDOSFunc
!NOINDEX
var
  IsamDOSFunc : Word;

DOS function code (value passed in AX to int $21) for the last
DOS call made by a Filer routine. Equals zero if no DOS call was
made.
;
;-------------------------------------------------------------------
!TOPIC 589 IsamError
!NOINDEX
var
  IsamError : Integer;

Error code of last Filer operation, zero if no error.

See also: 0494Error codes
;
;-------------------------------------------------------------------
!TOPIC 590 IsamFile
!NOINDEX
type
  IsamFile = record
      Handle : Word;
      Name   : array[0..0594IsamFileNameLen] of Char;
    end;

Format used to manage a file variable. Handle is the DOS file
handle number. Name is a null-terminated (ASCIIZ) string.
;
;-------------------------------------------------------------------
!TOPIC 591 IsamFileBlockName
!NOINDEX
type
  IsamFileBlockName = String[192];

Type used to describe the files in a fileblock. May contain one,
two, or three valid DOS filenames. The first filename specifies
the data file, the second specifies the index file, and the third
specifies the save file used for rebuild operations. When it
contains more than one filename, the names are separated by
semicolons.
;
;-------------------------------------------------------------------
!TOPIC 592 IsamFileBlockPtr
!NOINDEX
type
  IsamFileBlockPtr = ^IsamFileBlock;

Pointer to a fileblock variable. Every fileblock is managed with
a variable of this type. Such a variable is initialized by
calling 0554BTOpenFileBlock and deallocated by calling
0555BTCloseFileBlock.
;
;-------------------------------------------------------------------
!TOPIC 593 IsamFileName
!NOINDEX
type
  IsamFileName = String[0594IsamFileNameLen];

Each file that composes a fileblock (a data file, an index file,
a dialog file) is named with a string of this type. Note that the
default value of IsamFileNameLen allows pathnames of at most 64
characters, which is shorter than the DOS maximum.
;
;-------------------------------------------------------------------
!TOPIC 594 IsamFileNameLen
!NOINDEX
const
  IsamFileNameLen = 64;

The maximum length of a filename (including drive, directory,
filename, extension) stored in a fileblock variable. Note that
the default value limits names to less than the DOS maximum of
79.
;
;-------------------------------------------------------------------
!TOPIC 595 IsamFlushDOS33
!NOINDEX
const
  IsamFlushDOS33 : Boolean = True;

Leaving this constant set to True allows Filer to use DOS
function $68 to flush files to disk. This function is the most
reliable method for DOS versions 3.3 or later, but it isn't
supported by some operating systems, including PC/MOS-386, which
doesn't even return an error code to indicate that the flush
didn't occur successfully.
;
;-------------------------------------------------------------------
!TOPIC 596 IsamIndDescr
!NOINDEX
type
  IsamIndDescr = array[1..0603MaxNrOfKeys] of
    record
      KeyL : 1..0602MaxKeyLen;
      AllowDupK : Boolean;
    end;

A variable of this type is passed to 0553BTCreateFileBlock to
describe the indexes of the fileblock. KeyL specifies the maximum
length of the key strings in each index. AllowDupK determines
whether duplicate key strings are allowed in the index.
;
;-------------------------------------------------------------------
!TOPIC 597 IsamKeyStr
!NOINDEX
type
  IsamKeyStr = String[0602MaxKeyLen];

A string of this type is passed to and from various Filer
routines for managing the index file. No key string in any open
fileblock may be longer than this string type allows.
;
;-------------------------------------------------------------------
!TOPIC 598 IsamOK
!NOINDEX
var
  IsamOK : Boolean;

This variable returns the status of the last Filer operation. It
is True if the operation was completed successfully; False
otherwise. If the operation failed, check 0589IsamError for
further information.
;
;-------------------------------------------------------------------
!TOPIC 599 IsamReXUserProcPtr
!NOINDEX
var
  IsamReXUserProcPtr : Pointer;

Points to a user-supplied routine that is called by
2901ReorgFileBlock, 3794ReorgVFileBlock,
2800RebuildFileBlock, 3578RebuildVFileBlock, and
0747FixToVarFileBlock. The routine must be global, compiled
under the far model, and must have the following header:

  procedure CallUserRoutine(KeyNr : Integer;
                            DatSNrR, DatSNrW : LongInt;
                            var DatS; Len : Word);

KeyNr is the number of the index currently being reorganized
(zero for the data file); DatSNrR is the number of data records
that have been read so far; DatSNrW is the number that have been
written; DatS is the current data record; and Len is the length
of the current record.
;
;-------------------------------------------------------------------
!TOPIC 600 IxExtension
!NOINDEX
const
  IxExtension : String[3] = 'IX';

Extension applied to the index file of a fileblock.
;
;-------------------------------------------------------------------
!TOPIC 601 MaxHeight
!NOINDEX
const
  MaxHeight = 8;

Specifies the deepest level of the B-tree. In combination with
0608PageSize, determines the capacity of the index file. Do
not modify without a careful reading of Chapter 5.
;
;-------------------------------------------------------------------
!TOPIC 602 MaxKeyLen
!NOINDEX
const
  MaxKeyLen = 30;

Specifies the longest key string for any open fileblock. Minimum
memory usage of the index page buffers is proportional to
MaxKeyLen, but this constant does not affect index file size,
which is controlled by the 0596IsamIndDescr.
;
;-------------------------------------------------------------------
!TOPIC 603 MaxNrOfKeys
!NOINDEX
const
  MaxNrOfKeys = 100;

Specifies the maximum number of indexes per fileblock. May be
increased to no more than 254. This constant affects only the
size of variables of type 0596IsamIndDescr.
;
;-------------------------------------------------------------------
!TOPIC 604 MaxNrOfWorkStations
!NOINDEX
const
  MaxNrOfWorkStations : Word = 50;

Specifies the maximum number of workstations that Filer can
manage at one time. Valid workstation numbers must be in the
range 1..MaxNrOfWorkStations. Affects the size of a fileblock's
dialog file. All active workstations must use the same value of
this constant. Its value must be set before calling 0496BTInitIsam.
;
;-------------------------------------------------------------------
!TOPIC 605 MinimizeUseOfNormalHeap
!NOINDEX
const
  MinimizeUseOfNormalHeap = $40000000;

A bit flag that may be used to modify the meaning of the Free
parameter passed to 0496BTInitIsam. When this bit flag is set,
Filer allocates the minimum amount of normal heap space that it
can, leaving the rest for the application.
;
;-------------------------------------------------------------------
!TOPIC 606 MsgExtension
!NOINDEX
const
  MsgExtension : String[3] = 'MSG';

Extension applied to the message file of a fileblock. The message
file is created only if a fileblock reorganization detects
duplicate keys, in which case the associated data record is
written to the message file.
;
;-------------------------------------------------------------------
!TOPIC 607 NetSupportType
!NOINDEX
type
  NetSupportType = (NoNet, Novell, MsNet);

Enumerates the various network interfaces that Filer supports.
;
;-------------------------------------------------------------------
!TOPIC 608 PageSize
!NOINDEX
const
  CreatePageSize = 62;
  MaxPageSize = 62;

These constants specify the maximum number of key nodes in one index page.
In combination with 0601MaxHeight these control the overall
capacity of the B-tree. Do not change them without carefully reading
Chapter 5, but we recommend strongly that they are NOT changed.

CreatePageSize is used when fileblocks are created, MaxPageSize is used to
size the internal buffers for a particular application run. You should
always have CreatePageSize <= MaxPageSize.
;
;-------------------------------------------------------------------
!TOPIC 609 SavExtension
!NOINDEX
const
  SavExtension : String[3] = 'SAV';

Extension applied to the save file of a fileblock. The message
file is created only when a fileblock is reorganized. The save
file contains a backup copy of the data file and is left intact
until a successful reorganization is completed.
;
;-------------------------------------------------------------------
!TOPIC 610 SearchForSequentialDefault
!NOINDEX
const
  SearchForSequentialDefault : Boolean = True;

When this constant is True, 0536BTNextKey and 0537BTPrevKey will attempt
to recover automatically after the sequential pointer has been
disturbed. When False, the same situation leads to 0589IsamError
10255 or 10265.
;
;-------------------------------------------------------------------
!TOPIC 611 VersionStr
!NOINDEX
const
  VersionStr = '05.51';

Specifies the current version level of B-Tree Filer.
;
;-------------------------------------------------------------------
!TOPIC 612 BTPeekRecIsLocked
!NOINDEX
function 0487Filer.BTPeekRecIsLocked(IFBPtr : IsamFileBlockPtr;
                                 Ref : LongInt) : Boolean;

Just like 0508BTRecIsLocked but not destroying the previous error on success.
;
;-------------------------------------------------------------------
!TOPIC 613 BTPeekaRecIsLocked
!NOINDEX
function 0487Filer.BTPeekaRecIsLocked(IFBPtr : IsamFileBlockPtr) : Boolean;

Just like 0509BTaRecIsLocked but not destroying the previous error on success.
;
;-------------------------------------------------------------------
!TOPIC 614 BTPeekGetRecordInfo
!NOINDEX
procedure 0487Filer.BTPeekGetRecordInfo(IFBPtr : IsamFileBlockPtr;
                                    Ref : LongInt;
                                    var Start, Len : LongInt;
                                    var Handle : Word);

Just like 0510BTGetRecordInfo but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 615 BTPeekFileBlockIsOpen
!NOINDEX
function 0487Filer.BTPeekFileBlockIsOpen(IFBPtr : IsamFileBlockPtr)
    : Boolean;

Just like 0511BTFileBlockIsOpen but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 616 BTPeekFileBlockIsLocked
!NOINDEX
function 0487Filer.BTPeekFileBlockIsLocked(IFBPtr : IsamFileBlockPtr)
    : Boolean;

Just like 0512BTFileBlockIsLocked but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 617 BTPeekFileBlockIsReadLocked
!NOINDEX
function 0487Filer.BTPeekFileBlockIsReadLocked(IFBPtr : IsamFileBlockPtr)
    : Boolean;

Just like 0513BTFileBlockIsReadLocked but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 618 BTPeekNetSupported
!NOINDEX
function 0487Filer.BTPeekNetSupported : NetSupportType;

Just like 0516BTNetSupported but not destroying the previous error on success.
;
;-------------------------------------------------------------------
!TOPIC 619 BTPeekNoNetCompiled
!NOINDEX
function 0487Filer.BTPeekNoNetCompiled : Boolean;

Just like 0517BTNoNetCompiled but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 620 BTPeekIsNetFileBlock
!NOINDEX
function 0487Filer.BTPeekIsNetFileBlock(IFBPtr : IsamFileBlockPtr) : Boolean;

Just like 0518BTIsNetFileBlock but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 621 BTPeekNrOfKeys
!NOINDEX
function 0487Filer.BTPeekNrOfKeys(IFBPtr : IsamFileBlockPtr) : Word;

Just like 0529BTNrOfKeys but not destroying the previous error on success.
;
;-------------------------------------------------------------------
!TOPIC 622 BTPeekDatRecordSize
!NOINDEX
function 0487Filer.BTPeekDatRecordSize(IFBPtr : IsamFileBlockPtr) : LongInt;

Just like 0530BTDatRecordSize but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 623 BTPeekKeyRecordSize
!NOINDEX
function 0487Filer.BTPeekKeyRecordSize(IFBPtr : IsamFileBlockPtr) : LongInt;

Just like 0531BTKeyRecordSize but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 624 BTPeekMinimumDatKeys
!NOINDEX
function 0487Filer.BTPeekMinimumDatKeys(IFBPtr : IsamFileBlockPtr;
                                    Space  : LongInt) : LongInt;

Just like 0532BTMinimumDatKeys but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 625 BTPeekDataFileName
!NOINDEX
function 0487Filer.BTPeekDataFileName(IFBPtr : IsamFileBlockPtr)
    : IsamFileName;

Just like 0558BTDataFileName but not destroying the previous error on success.
;
;-------------------------------------------------------------------
!TOPIC 626 BTPeekIndexFileName
!NOINDEX
function 0487Filer.BTPeekIndexFileName(IFBPtr : IsamFileBlockPtr)
    : IsamFileName;

Just like 0559BTIndexFileName but not destroying the previous error on
success.
;
;-------------------------------------------------------------------
!TOPIC 627 BTGetStartingLong
!NOINDEX
procedure 0487Filer.BTGetStartingLong(IFBPtr : IsamFileBlockPtr;
                                  RefNr : LongInt;
                                  var Dest: LongInt);

Reads the first four bytes of the specified record into Dest.

See also: 0521BTGetRec
;
;-------------------------------------------------------------------
!TOPIC 628 BTInformTTSAbortSuccessful
!NOINDEX
procedure 0487Filer.BTInformTTSAbortSuccessful(IFBPtr : IsamFileBlockPtr);

Clear all buffered internal data and remove all locks from a
file after a successful NetWare TTS transaction abort.
;
;-------------------------------------------------------------------
!TOPIC 629 BTGetNextUsedAddRecRef
!NOINDEX
function 0487Filer.BTGetNextUsedAddRecRef(IFBPtr : IsamFileBlockPtr)
    : LongInt;

Return the reference number that will be assigned to the
next record added.

See also: 0630BTGetAfterNextUsedAddRecRef
;
;-------------------------------------------------------------------
!TOPIC 630 BTGetAfterNextUsedAddRecRef
!NOINDEX
function 0487Filer.BTGetAfterNextUsedAddRecRef(IFBPtr : IsamFileBlockPtr)
    : LongInt;

Return the reference number that will be assigned to the
record added after the next record is added.

See also: 0629BTGetNextUsedAddRecRef
;
;-------------------------------------------------------------------
!TOPIC 631 BTGetInternalDialogID
!NOINDEX
function 0487Filer.BTGetInternalDialogID(IFBPtr : IsamFileBlockPtr) : Word;

Return the internal workstation ID that is used for the
specified fileblock.
;
;-------------------------------------------------------------------
!TOPIC 632 IsamFBLockTimeOutFactor
!NOINDEX
const
  IsamFBLockTimeOutFactor : Word = 4;

The multiple of 0633IsamLockTimeOut for which fileblock locks
are retried.
;
;-------------------------------------------------------------------
!TOPIC 633 IsamLockTimeOut
!NOINDEX
const
  IsamLockTimeOut : Word = 768;

The number of milliseconds for which Filer automatically
tries to get a lock. IsamLockTimeOut applies to all locks
except for fileblock locks, for which it tries
0632IsamFBLockTimeOutFactor times IsamLockTimeOut milliseconds.
;
;-------------------------------------------------------------------
!TOPIC 634 InheritFileHandles
!NOINDEX
const
  InheritFileHandles = False;

This constant determines whether any child processes will inherit the
B-Tree Filer fileblock handles or not. Note that, if true, the child
process will only inherit the file handles, it will not inherit any of
the B-Tree Filer data structures from the parent. The default is
false to comply with the behavior of previous versions of Filer.
;
;-------------------------------------------------------------------
!TOPIC 635 TestNetExistance
!NOINDEX
const
  TestNetExistance : Boolean = True;

If true, 0496BTInitIsam will check whether the network specified in the
ExpectedNet parameter exists or not; if the network is not found,
BTInitIsam will fail. If this typed constant is false, no check is
made for the network, it is assumed to be present.
;
;-------------------------------------------------------------------
!TOPIC 636 BTFindRecRef
!NOINDEX
procedure 0487Filer.BTFindRecRef(IFBPtr : IsamFileBlockPtr;
                             var UserDatRef          : LongInt;
                             NotFoundSearchDirection : Integer);

This routine mimics the 0540BTFindKeyAndRef routine without using an index.
The record with reference UserDatRef is read; if it is not deleted then
this routine returns immediately without error. If the record is deleted,
the parameter NotFoundSearchDirection determines whether to search further
through the data file. A value of 0 means to end the search. A positive
value means to search forwards sequentially through the records until the
first active record is found, or the end of the file is reached. A negative
value means to search backwards through the records until the first active
record is found, or the start of the file is reached. If an active record
is found, its reference number is returned in UserDatRef with IsamOK set
to True and IsamError set to zero. If an active record could not be found
(i.e., NotFoundSearchDirection was zero and the record was deleted, or the
search could not find an active record), then IsamOk is set to False and
IsamError is set to 10275. If a locked record was encountered during the
initial read or the subsequent searching, this procedure returns immediately
with IsamError set to 10390 and the offending record reference number in
UserDatRef. You can then decide whether to jump over this record or perform
some other type of action.

See also:  0641BTNextRecRef  0643BTPrevRecRef
;
;-------------------------------------------------------------------
!TOPIC 637 BTGetApprRecPos
!NOINDEX
procedure 0487Filer.BTGetApprRecPos(IFBPtr : IsamFileBlockPtr;
                                var RelPos : Word;
                                Scale      : Word;
                                UserDatRef : LongInt);

This procedure works in an analogous manner to 0549BTGetApprRelPos but does
not refer to any index or to the B-Tree; it just uses the data file.

Given a UserDatRef data reference BTGetApprRecPos calculates a relative position
RelPos of the record in the data file, in the range 0..Scale.

This routine could be used to convert a data reference into a thumb position
within a scrollbar. In text mode, Scale should typically be the number
of screen characters assigned to the scrollbar, minus 1.

See also:  0638BTGetApprRecRef
;
;-------------------------------------------------------------------
!TOPIC 638 BTGetApprRecRef
!NOINDEX
procedure 0487Filer.BTGetApprRecRef(IFBPtr : IsamFileBlockPtr;
                                RelPos : Word;
                                Scale  : Word;
                                var UserDatRef : LongInt);

This procedure works in an analogous manner to 0550BTGetApprKeyAndRef but
does not refer to any index or to the B-Tree; it just uses the data
file.

Given the relative position RelPos in the range 0..Scale, BTGetApprRecRef
returns the data reference UserDatRef of the record that most closely
approximates the specified position. The reference number returned will not
necessarily refer to an active record. It could be for a deleted record.

This routine could be used to calculate a record number given a thumb
position within a scrollbar. In text mode, Scale should typically be the
number of screen characters assigned to the scrollbar, minus 1.

See also:  0637BTGetApprRecPos
;
;-------------------------------------------------------------------
!TOPIC 639 BTGetKeyLen
!NOINDEX
function 0487Filer.BTGetKeyLen(IFBPtr : IsamFileBlockPtr;
                           KeyNr  : Word) : Word;

This function allows you to determine at runtime how long the keys are
in index KeyNr of fileblock IFBPtr. This information is encoded into the
fileblock by 0553BTCreateFileBlock.

See also:  0645BTGetAllowDupKeys
;
;-------------------------------------------------------------------
!TOPIC 640 BTIsInitialized
!NOINDEX
function 0487Filer.BTIsInitialized : Boolean;

B-Tree Filer is initialized with 0496BTInitIsam and closed down with 0497BTExitIsam.
This function returns False before BTInitIsam is called, True afterwards.
When BTExitIsam is called, it again returns False.
;
;-------------------------------------------------------------------
!TOPIC 641 BTNextRecRef
!NOINDEX
procedure 0487Filer.BTNextRecRef(IFBPtr : IsamFileBlockPtr;
                             var UserDatRef : LongInt);

This procedure searches forward sequentially through the records in
the data file, starting at UserDatRef+1, until an active record is
found or the end of file is encountered. If an active record is
found, its reference number is returned in UserDatRef. If the end
of file is encountered without finding an active record, IsamError is
set to 10275.

If a locked record is found during the search, IsamError is set to
10390 and the locked record reference number is returned in UserDatRef.
Calling BTNextRecRef immediately with that value of UserDatRef causes
the locked record to be skipped. If however you would like to try that
record again, decrement UserDatRef by one and call BTNextRecRef again
after a small delay.

See also:  0636BTFindRecRef  0643BTPrevRecRef
;
;-------------------------------------------------------------------
!TOPIC 642 BTNoCharConvert
!NOINDEX
procedure 0487Filer.BTNoCharConvert(DataPtr  : Pointer;
                                DataLen  : LongInt;
                                PostRead : Boolean;
                                HookPtr  : Pointer);

Procedures of type 0646ProcBTCharConvert (of which this is one) are designed
to provide support for different external and internal representations
of data records, in particular multiple code pages. BTNoCharConvert does
nothing; the record pointed to by DataPtr is not altered.

This procedure can be passed to a call to 3007RestructFileBlock (in the
3001RESTRUCT unit) if you do not want any character conversion to take
place.
;
;-------------------------------------------------------------------
!TOPIC 643 BTPrevRecRef
!NOINDEX
procedure 0487Filer.BTPrevRecRef(IFBPtr : IsamFileBlockPtr;
                             var UserDatRef : LongInt);

This procedure searches backward sequentially through the records in
the data file, starting at UserDatRef-1, until an active record is found or
the start of the file is encountered. If an active record is found, its
reference number is returned in UserDatRef. If the start of the file
was encountered without finding an active record, IsamError is set to 10275.

If a locked record was found during the search, IsamError is set to 10390
and the locked record reference number is returned in UserDatRef. Calling
BTPrevRecRef immediately with that value of UserDatRef causes the locked
record to be skipped. However, if you need to access that record again,
increment UserDatRef by one and call BTPrevRecRef after a small delay.

See also:  0636BTFindRecRef  0641BTNextRecRef

;
;-------------------------------------------------------------------
!TOPIC 644 BTSetCharConvert
!NOINDEX
procedure 0487Filer.BTSetCharConvert(IFBPtr : IsamFileBlockPtr;
                                 CCProc     : ProcBTCharConvert;
                                 HookPtr    : Pointer;
                                 DestrWrite : Boolean);

Record conversion routines are called after a record is read from a
fileblock and before a record is written to a fileblock. This interface
enables you to convert a record from an external representation to an
internal one (or vice versa). For example, you can convert text strings
in a record from the calling system's code page to the code page of the
fileblock.

This procedure sets the record conversion routine which will be used for
the fileblock IFBPtr (which must be open). CCProc is a procedure of
type 0646ProcBTCharConvert that does the conversion. HookPtr is a pointer to
any type of data structure; this pointer is passed unmodified to
CCProc when a record is read or written.

When a record is written to the fileblock's data file, CCProc is called
to convert the record in place (a copy of the record is not made). If,
after the record is written, the data in the record buffer will not be
used by the rest of the application, set DestrWrite to True. If the data
in the record buffer will be used by the application after writing the
record, set the DestrWrite parameter to False. In this case the
CCProc routine is called a second time to convert the record back again to
the internal format (as if the record had just been read).
;
;-------------------------------------------------------------------
!TOPIC 645 BTGetAllowDupKeys
!NOINDEX
function 0487Filer.BTGetAllowDupKeys(IFBPtr : IsamFileBlockPtr;
                                 KeyNr  : Word) : Boolean;

This function allows you to determine at runtime whether the index
specified by KeyNr of fileblock IFBPtr allows duplicate keys. This
information is encoded into the fileblock by 0553BTCreateFileBlock.

See also:  0639BTGetKeyLen
;
;-------------------------------------------------------------------
!TOPIC 646 ProcBTCharConvert
!NOINDEX
type
  ProcBTCharConvert = procedure (DataPtr  : Pointer;
                                 DataLen  : LongInt;
                                 PostRead : Boolean;
                                 HookPtr  : Pointer);

This procedural type defines a record conversion routine that is called
when a record is read and when it is written. The idea behind this type of
routine is to enable you to have two different formats for your records: an
external format that resides in the fileblock, and an internal format
that you use in your application. Examples are support for different code
pages between the fileblock and the application, for string encryption, and
for record compression.

DataPtr is a pointer to the record that was just read or about to be written,
DataLen is its length.

PostRead is True if the record has just been read from the fileblock (in
other words, the routine is being called to convert the record from an
external format to your internal one), and is False if the record is about
to be written (in other words the record needs to be converted to the
external format).

HookPtr is a pointer to any user-defined data structure; it is a way of
passing other information to this routine.

See also:  0644BTSetCharConvert
